---
title: os系统基本概念
date: 2025-03-12 08:49:53
mathjax: true
categories: 
    - CS基础
cover: https://gcore.jsdelivr.net/gh/WQhuanm/Img_repo_1@main/img/202504172122315.png
---


### 一，进程和线程
> 进程是资源分配的最小单位，线程是CPU调度的最小单位

1. 进程间的通信方式
    + 管道/匿名管道(Pipes) ：半双工，用于具有亲缘关系的父子进程间或者兄弟进程之间的通信（消息在内核缓冲区）
    + 有名管道(Named Pipes) : 严格遵循先进先出。有名管道以磁盘文件的方式存在，可以实现本机任意两个进程通信。
    + 共享内存：需要依靠某种同步操作，如互斥锁和信号量等。可以说这是最有用的进程间通信方式。

1. 进程的调度算法
    + 先到先服务调度算法(FCFS，First Come, First Served) 
    + 短作业优先的调度算法(SJF，Shortest Job First)
    + 时间片轮转调度算法（RR，Round-Robin）
    + 优先级调度算法（Priority）
    + 多级反馈队列调度算法（MFQ，Multi-level Feedback Queue）

1. 僵尸进程和孤儿进程
    + 子进程exit结束时，内核会释放该进程的所有资源，但其PCB依然存在于系统中。直到其父进程调用wait()才会被释放，以便让父进程得到子进程的状态信息。
    + 僵尸进程：子进程终止，但父进程没有调用 wait()导致子进程的 PCB 依然存在于系统中，但无法被进一步使用。该子进程被称为“僵尸进程”。
    + 孤儿进程：父进程终止，但子进程仍在运行，未被wait()回收。该子进程为“孤儿进程”。OS会将孤儿进程的父进程设置为 init 进程（进程号为 1），由 init 进程来回收孤儿进程的资源。


1. 用户线程和守护线程
    1. 用户线程：只有所有用户线程结束，JVM才能终止（主线程main结束）
    1. 守护线程：不会阻止JVM结束
        + JVM结束时守护线程会被强制终止，不推荐执行I/O任务,会导致无法正确关闭资源
        + 守护线程一般用于后台支持任务，比如垃圾回收、释放未使用对象的内存等


### 二，死锁
1. 死锁的四个必要条件
    1. 互斥：资源必须处于非共享模式，即一次只有一个进程可以使用。
    1. 占有并等待：一个进程至少应该占有一个资源，并等待另一资源，而该资源被其他进程所占有。
    1. 非抢占：资源不能被抢占。只能在持有资源的进程完成任务后，该资源才会被释放。
    1. 循环等待：进程对资源的等待形成一个环

1. 死锁的预防
    1. 静态分配策略（破坏占有并等待）：进程只有执行前能申请所有资源才执行
    1. 层次分配策略（破坏循环等待）：资源分成多个层次，必须申请到低级资源才能申请高级资源，必须释放高级资源才能释放低级资源（单向性使得不存在循环等待，不会有高级资源申请低级资源的情况）

1. 死锁的避免
    + 将系统的状态分为 安全状态 和 不安全状态 ，在为申请者分配资源前先测试系统状态，若把系统资源分配给申请者会产生死锁，则拒绝分配，否则接受申请，并为它分配资源。（银行家算法）

1. 死锁的检测：进程-资源分配图

1. 死锁的解除
    1. 抢占资源：从涉及死锁的一个或几个进程中抢占资源，把夺得的资源再分配给涉及死锁的进程直至死锁解除。
    1. 逐个撤销涉及死锁的进程，回收其资源直至死锁解除。
    
### 三，内存管理
1. 分段机制：每个申请内存的程序分配一个适合它大小的连续物理段，程序的虚拟地址通过段表映射到其分配的段上
    + 缺点：容易产生外部内存碎片（明明内存够分配给进程，但是不存在足够大小的**连续内存段**）
1. 分页机制：把物理内存分为连续等长的物理页（一般是4KB），虚拟内存也被划分成页。内存页是管理的基本单位
    + 多级页表的映射
        + 局部性原理：大多数进程不会使用到所有页，只使用少部分，一开始就给1024张页表太亏，采用2级页表：永存第一级页表，需要才增加第二级页表
        + 虚拟内存的地址的含义 ：[一级页表偏移量（10位），二级页表偏移量(10位)，页内地址偏移量（12位）]
    + 快表（TLB，Translation Lookaside Buffer）：即缓存，避免使用多级页表查询
    + 缺页中断（需要切换内核态，因为每个进程都可以保存一定数量的内存页而不是所有）
        + 硬性页缺失（Hard Page Fault）：如果访问页面不在内存，需要产生缺页中断，将该虚拟内存页映射的物理内存页(被置换到磁盘上了)拿到内存
        + 软性页缺失（Soft Page Fault）：物理内存中有对应的物理页，但虚拟页还未和物理页建立映射。    
    + 页面置换算法（减少缺页中断的产生）
        + 最佳页面置换算法（OPT，Optimal）
        + 先进先出页面置换算法（FIFO，First In First Out）：存在BeLady现象：分配的页面数增多但缺页率反而提高
        + 最近最久未使用页面置换算法（LRU ，Least Recently Used）：记录页面上次访问时间
        + 最少使用页面置换算法（LFU，Least Frequently Used） : 记录页面使用次数
1. 段页机制：把物理内存先分成若干段，每个段又继续分成若干大小相等的页。

### 四，文件系统
1. 硬链接和软链接：每个文件和目录都有一个唯一的索引节点（inode）号，用来标识该文件或目录。
    1. 硬链接（Hard Link，ln命令）：不能跨文件系统，硬链接通过 inode 节点号建立连接，硬链接和源文件的 inode 节点号相同，两者对文件系统来说是完全平等的
    1. 软链接（Symbolic Link，ln -s命令）：能跨文件系统，类似快捷方式，可指向空文件/目录

1. 磁盘调度算法
    1. 先来先服务算法（First-Come First-Served，FCFS）
    1. 最短寻道时间优先算法（Shortest Seek Time First，SSTF）：优先选择距离当前磁头位置最近的请求进行服务
    1. 扫描算法（SCAN）：扫描到边界才转向
    1. 边扫描边观察算法（LOOK）：改进SCAN，移动方向上无请求，立即改变磁头方向
    1. 循环扫描算法（Circular Scan，C-SCAN）：只按照一个方向扫描
    1. 均衡循环扫描算法（C-LOOK）：改进C-SCAN，移动方向上无请求，立即让磁头返回



